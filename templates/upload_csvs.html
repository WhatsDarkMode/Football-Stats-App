<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>CSV Upload</title>
</head>
<body>
    <h2>Upload Match Data and Player Keys CSVs</h2>
    <form id="uploadForm" method="post" action="/upload_csv" enctype="multipart/form-data">
        <label for="matchData">Match Data CSV:</label>
        <input type="file" id="matchData" name="match_data" accept=".csv" required><br><br>
        
        <label for="playerKeys">Player Keys CSV:</label>
        <input type="file" id="playerKeys" name="player_keys" accept=".csv" required><br><br>
        
        <button type="button" onclick="uploadFiles()">Upload</button>        
    </form>

    <div id="result"></div>

    <script>
        async function uploadFiles() {
            const formData = new FormData();
            const matchData = document.getElementById("matchData").files[0];
            const playerKeys = document.getElementById("playerKeys").files[0];

            if (!matchData || !playerKeys) {
                document.getElementById("result").innerText = "Both files are required!";
                return;
            }

            formData.append("match_data", matchData);
            formData.append("player_keys", playerKeys);

            try {
                const response = await fetch("/upload_csv", {
                    method: "POST",
                    body: formData
                });

                // Check if redirect status
                if (response.redirected) {
                    window.location.href = response.url;  // Redirect to the new page
                    return;
                }

                const result = await response.json();
                document.getElementById("result").innerText = result.message || result.error;
            } catch (error) {
                document.getElementById("result").innerText = "Error uploading files.";
            }
        }
    </script>    
</body>
</html>
